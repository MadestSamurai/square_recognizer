# 正方形外直角检测器

## 功能描述

这个程序实现了对于白色位图上重叠的黑色正方形（支持任意角度旋转），检测其中的外直角（即向外凸出的90度直角）以及正方形的功能。

## 核心功能

1. **正方形绘制**: 
   - 普通正方形绘制（轴对齐）
   - 旋转正方形绘制（支持任意角度）
2. **角点检测**: 检测黑色区域向外凸出的90度直角
3. **角点存储**: 每个直角存储包含：
   - 直角点坐标
   - 两个辅助角点（用于确定直角边的方向）
4. **可视化**: 生成带有标注的检测结果图像

## 外直角定义

外直角是指向外凸出的90度角，具体特征：
- 直角点本身为黑色像素
- 两个垂直方向延伸一定距离都是黑色像素（形成直角边）
- 外角的外侧区域为白色
- 内角的内侧区域为黑色（确保是实心角）

## 旋转支持

程序支持检测任意角度旋转的正方形外直角：
- **普通检测**: 适用于轴对齐的正方形
- **旋转检测**: 使用极坐标方法检测任意角度的外直角
  - 检测周围360度范围内黑色到白色的边界
  - 寻找两个边界形成约90度角的情况
  - 自动过滤重复和误检

## 输出结果

程序会生成以下文件：
- `original_squares.png`: 原始的黑色正方形图像（包含旋转）
- `corners_detected.png`: 标注了检测到的外直角的可视化图像

## 可视化说明

在检测结果图像中：
- **红色圆圈**: 外直角点
- **绿色圆圈**: 辅助角点（确定直角边方向）
- **蓝色线条**: 直角边
- **黄色数字**: 外直角编号

## 使用方法

```bash
python main.py
```

## 代码结构

### CornerDetector 类

- `__init__()`: 初始化位图
- `draw_square()`: 绘制轴对齐的黑色正方形
- `draw_rotated_square()`: 绘制任意角度旋转的黑色正方形
- `draw_test_squares()`: 绘制预设的测试正方形（包含旋转）
- `is_black_pixel()`: 检查像素是否为黑色
- `check_outer_corner()`: 检查轴对齐的外直角
- `check_rotated_outer_corner()`: 检查任意角度的外直角
- `detect_all_outer_corners()`: 检测图像中所有外直角
- `visualize_corners()`: 可视化检测结果
- `save_image()`: 保存图像文件
- `print_corner_info()`: 打印外直角信息

## 检测算法特点

### 普通外直角检测
- 使用邻域模式匹配
- 检查直角边延伸的连续性
- 验证外侧白色区域和内侧黑色区域

### 旋转外直角检测
- 极坐标扫描法
- 检测黑白边界转换
- 90度角度匹配（允许70-110度误差）
- 自动去重机制

## 技术特点

1. **精确检测**: 多层验证确保检测精度
2. **旋转支持**: 支持任意角度旋转的正方形
3. **去重机制**: 自动过滤距离过近的重复角点
4. **可视化友好**: 清晰的颜色标注和编号系统
5. **性能优化**: 使用步长采样提高检测效率

## 依赖库

- numpy: 数组操作和数学计算
- opencv-python: 图像处理、绘制和显示
- typing: 类型注解

## 应用场景

- 计算机视觉中的角点检测
- 几何形状识别和分析
- 旋转物体的角点检测
- 图像处理算法研究
- 机器视觉质量检测
